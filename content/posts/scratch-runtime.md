---
title: "Scratch漫谈"
date: 2021-12-11T11:45:36+08:00
draft: true
tags: ['scratch', 'python']
categories: ['scratch' ]
---

# Scratch漫谈

Scratch是最流行的图形化编程语言，这次因为项目原因，我从头自己实现了一个基于Python的Scratch runtime，因此深入了解了一下scratch的编程模型，感觉设计还是很不错的，下面我就来聊一下Scratch。

## Scratch简介

Scratch的核心是角色（sprite），每个角色都有自己的多个造型（costume），每个角色都有自己的控制逻辑，这些控制逻辑使用积木块（block）的方式来表示。

## 积木块的分类

积木块可以按颜色进行功能上的分类

* 外形（looks）：
    修改角色的造型，显示文字气泡。

* 移动（motion）：
    移动角色的位置/方向/所在层次。

* 控制（control）：
提供分支，循环等积木块。
另外一个重要的功能clone也是在这个分类中。

* 事件（event）：
在角色之间传递消息，以及一些系统及的消息也是放在这个分类中。

* 声音（sound）：
播放音频，调整音量，音阶，声道

* 变量（variable）：
变量分为变量和列表两种，变量没有类型，可以是数值，也可以是字符串，是哪种类型需要根据使用的上下文来区分
变量的作用域分为角色内部变量和全局变量
这个分类中还提供了操作变量的各种数学运算，列表的操作和字符串的操作

* 自定义积木（custom block）：
可以通过组合多个积木块来构造自己的积木，说白了就是定义过程（procedure）。
需要注意的是在scratch中，自定义积木块是过程（procedure）而不是函数（function），即没有返回值。
如果需要返回值，只能通过变量来实现。

* 扩展类积木（extension）：
用户可以编写自己的积木，来提供自己的独特功能。官方也提供了一些扩展，其中使用比较广泛的是画笔（pen）这个扩展，后面我会展开说明。

积木块也可以按形状进行分类

* 帽子（hat）
* C型
* stack类
* Cap类
* Boolean类 <>
* Reporter类 ()
* Menu类

一组积木可以堆叠（stack）在一起构成一个完整的执行链，这一组积木需要由一个帽子积木块起始，中间包含0-n个C型积木和stack类积木，由一个可选的cap类积木结尾。

帽子积木用于指定这一组积木执行的时机，比如当绿旗被按下时开始执行；
C型积木用于包裹其他积木，一般C型积木都是分支/循环这种控制类积木；
绝大多数功能性的积木都是属于stack类；
Cap类积木则是用于明确表示执行结束，因此在这类积木的下面是不能再添加其他积木的。

特别的，Boolean类可以用于分支语句中的条件判断；Reporter类积木用于获取某些数据的值，比如用户自定义变量的值，或者系统内部定义变量的值（如角色的X轴坐标）。这两类积木都是必须嵌入在其他积木块中的。

Menu类积木块在官方文档中并未提及，这类积木块一般是Reporter类型的，用于提供一个菜单来给用户进行选择。有时候Menu类积木可以用其他Reporter类积木替换，而这个Menu类积木就被shadowed了。

## Hat类积木的restartable属性

Hat类积木用于


